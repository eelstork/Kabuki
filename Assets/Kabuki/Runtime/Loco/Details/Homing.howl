âŠ UnityEngine; âŠ Active.Core; âŠÌ¥ Active.Status;

âŠ“ Active.Loco{
â€’ â—‹ Homing : LocoTask{

    ãƒ¡ target;
    ã…… speed;

    â€’ ã…‡ Update(ãƒ¡ target, ã…… speed){
        ã…‡ changed = false;
        â¤´ (â¦¿.target â‰  â—) { â¦¿.â— = â—; changed = âœ“; }
        â¤´ (â¦¿.speed  â‰  ğ‡) { â¦¿.ğ‡ = ğ‡; changed = âœ“; }
        //â¤´ (changed) Debug.LogError("target has changed");
        â® changed;
    }

    âºâ€’ â‘‚ Step(PhysicalLocomotion o){
        âˆ™ dist = ã‚·.Distance(o.ã¿Ë™, target);
        â¤´ (dist < 0.1f){
            // TODO: do not ever mutate on 'done'
            // o.Play("Idle");
            // o.motor.Stop(o.ã¿, o.body);
            // o.rotor.Stop(o.ã¿, o.body);
            â® â—‡[log âˆ§ "On target"];
        }
        âˆ™ direction = (target - o.ã¿Ë™)Â¹;
        o.rotor.Update(direction, o.ã¿, o.body);
        // Maybe no clear LOS here since course corrections take time.
        // was o.ã¿Ë™
        â¤´ (Avoidance.HasClearLOS(o.shape.bounds.center,
                                  o.body.ğ“‹, 1f)){
            âˆ™ s = ğ‡;
            â¤´ (dist â‰¤ 1f) s *= dist;
            o.motor.Update(direction, s, o.ã¿, o.body);
            o.Play("Walk");
            â® â˜¡[log âˆ§ "Move"];
        }â¤µ {
            // So, if not, stop moving.
            o.motor.Stop(o.ã¿, o.body);
            o.Play("Idle");
            â® â˜¡[log âˆ§ "Stall"];
        }
    }

}}
