âŠ Ex = System.Exception;
âŠ UnityEngine; âŠÌ¥ UnityEngine.Time; âŠÌ¥ UnityEngine.Mathf;
âŠ Active.Core; âŠÌ¥ Active.Core.status;

âŠ“ Activ.Kabuki{
â€’Ì¥ â—‹ TransformExt{

    â€’Ì¥ ã‚· Dir(â¦¿ ã‚¨ x, ã‚¨ y, ã…‡ planar = âœ—)
        â†’ planar ? (yË™ - xË™).X_Z()Â¹ : (yË™ - xË™)Â¹;

    â€’Ì¥ ã…… Dist(â¦¿ ã‚¨ x, ã‚¨ y) â†’ ãƒ¡.Distance(xË™, yË™);

    â€’Ì¥ ã…… Radius(â¦¿ ã‚¨ x){
        âˆ™ bounds = x.GetComponentInChildren<Renderer>().bounds;
        âˆ™ s = bounds.size;
        â® (s.x + s.y + s.z) / 6 á§ 0.7f;
    }

    â€’Ì¥ ã‚¨ Req(â¦¿ ã‚¨ x, â‹¯ ã„¹[] hints){
        âˆ™ ã„¸ = x.Find(hints);
        â® ã„¸ â‰  âˆ… ? ã„¸ : (â•¯Â°â–¡Â°)â•¯ âŒ¢ Ex("Not found: " + hints);

    }

    â€’Ì¥ ã‚¨ Find(â¦¿ ã‚¨ x, â‹¯ ã„¹[] hints){
        âˆ€ (ã‚¨ child âˆˆ x){
            âˆ™ name = childË®.ToLower();  ã…‡ match = âœ“;
            âˆ€ (âˆ™ h âˆˆ hints) â¤´ (!name.âˆ‹(h)){ match = false; Â¦ }
            â¤´ (match) â® child;
            âˆ™ ã„¸ = child.Find(hints);
            â¤´ (ã„¸ â‰  âˆ…) â® ã„¸;
        }
        â‚
    }

    â€’Ì¥ ã…‡ Has(â¦¿ ã‚¨ x, ã‚¨ y) â†’ y.IsAncestor(x);

    // is y an ancestor of x?
    â€’Ì¥ ã…‡ IsAncestor(â¦¿ ã‚¨ x, ã‚¨ y){
        âŸ² (x â‰  null){
            â¤´ (x â˜° y) ã†‘
            x = x.parent;
        } â¤¬
    }

    â€’Ì¥ ã…… Look(â¦¿ ã‚¨ x, ã‚¨ y, ã…‡ planar = âœ“)
        â†’ ã‚·.Angle(x.forward, x.Dir(y, planar: planar));

    â€’Ì¥ â‘‚ RotateTowards(â¦¿ ã‚¨ Î¸, ã‚¨ target, ã…… speed, ã…… Î¼ = 0.1f){
        ã‚· u = Î¸.forward;
        ã‚· v = Î¸.Dir(target, planar: âœ“);
        ã…… Î± = ã‚·.Angle(u, v);
        â¤´ (Î± < Î¼) â—‡Ì 
        Î¸.forward = ãƒ¡.RotateTowards(u, v, ğ‡ á§ ğ›¿ğš á§ âˆ Ê³, 1f);
        â˜¡Ì±
    }

    â€’Ì¥ â‘‚ RotateTowards(â¦¿ ã‚¨ Î¸, ãƒ¡ dir, ã…… speed, ã…… Î¼ = 0.1f){
        ãƒ¡ u = Î¸.forward;
        ã…… Î± = ã‚·.Angle(u, dir);
        â¤´ (Î± < Î¼) â—‡Ì 
        Î¸.forward = ã‚·.RotateTowards(u, dir, ğ‡ á§ ğ›¿ğš á§ âˆ Ê³, 1f);
        â˜¡Ì±
    }

    â€’Ì¥ â‘‚ MoveTowards(â¦¿ ã‚¨ x, ã‚¨ y, ã…… dist, ã…… speed)
        â†’ x.PlanarDist(y) < dist
        âˆ¨ Repeat( xË™ += x.PlanarDir(y) á§ ğ›¿ğš á§ ğ‡ );

    â€’Ì¥ ã…… PlanarDist(â¦¿ ã‚¨ x, ã‚¨ y) â†’ (yË™ - xË™).X_Z()âš;

    â€’Ì¥ ã‚· PlanarDir(â¦¿ ã‚¨ x, ã‚¨ y) â†’ (yË™ - xË™).X_Z()Â¹;

    // --------------------------------------------------------------

    âˆ˜ â–· Do(âŠ¡ x) { âŒ½ }
    âˆ˜ â‘‚ Repeat(âŠ¡ x) { â˜¡Ì± }

}}
